/*! (C) Andrea Giammarchi Mit Style License */
define(function(){(function(e){"use strict";function v(e,t,n){E(this,e,t,n)}function m(){x.call(this),this._stopImmediatePropagation()}function g(e){return{enumerable:!1,writable:!0,configurable:!0,value:e}}function y(e,n,r){var i=n[t]||(n[t]={m:[],b:[]}),s=typeof r=="string"?e[r]:r,o=i.m.indexOf(s);return o<0?i.b[i.m.push(s)-1]=s.bind(e):i.b[o]}function b(e){return function(){return s(this,a&&"dispatchEvent"in this?l:c)[e].apply(this,arguments)}}function w(e,t,n){t in e||(e[t]=n)}function E(e,t,n,r){w(e,"timeStamp",Date.now());for(var i in r)w(e,i,r[i]);w(e,"type",n),w(e,"target",t),r&&w(e,"data",r)}function S(e){return e._active=!0,e._stopImmediatePropagation=e.stopImmediatePropagation,e.stopImmediatePropagation=m,e}function x(){i(this,"_active",h)}function T(e,t,n){typeof e=="function"?e.apply(t,n):e.handleEvent.apply(e,n)}function N(e,t,n){typeof e=="function"?e.call(t,n):e.handleEvent(n)}function C(e){T(e,this.context,this.arguments)}function k(e){return C.call(this,e),this.arguments[0]._active}if(e.eddy)return;var t="_@eddy:"+Math.random(),n=e.Object,r=n.create,i=n.defineProperty,s=n.defineProperties,o=Array.prototype.slice,u=e.Node||e.Element||e.HTMLElement,a=!!u,f=g(function(t,n,r){var i=this;return i.on(t,function s(){i.off(t,s,r),T(n,i,arguments)},r)}),l={boundTo:g(function(e){return y(this,d.get(this)||(d.set(this,r(null)),d.get(this)),e)}),emit:g(function(t){return this.trigger(t,{data:o.call(arguments,1)})}),off:g(function(t,n,r){return this.removeEventListener(t,n,!!r),this}),on:g(function(t,n,r){return this.addEventListener(t,n,!!r),this}),once:f,trigger:g(function(n,r){var i=typeof n=="string",s=i?n:(r=n).type,o=(this.ownerDocument||this.document||e.document).createEvent("Event");return o.initEvent(s,r&&r.bubbles||1,r&&r.cancelable||1),E(o,this,s,i&&r),this.dispatchEvent(o)})},c={boundTo:g(function(e){return y(this,this[t],e)}),emit:g(function(n){var r=this[t][n],i=!!r;return i&&r.forEach(C,{arguments:(r.shift.call(arguments),arguments),context:this}),i}),off:g(function(n,r){var i=this[t],s=i[n],o;return s&&(o=s.indexOf(r),-1<o&&(s.splice(o,1),s.length||delete i[n])),this}),on:g(function(n,r){var i=this[t],s=i[n]||(i[n]=[]);return s.indexOf(r)<0&&s.push(r),this}),once:f,trigger:g(function(n,r){var i=this[t],s=typeof n=="string",o=i[s?n:n.type];return o?o.every(k,{arguments:[s?new v(this,n,r):n instanceof v?n:S(n)],context:this}):!0})},h={value:!1},p=e.WeakMap,d;a&&(d=p?new p:{get:function(e){return e[t]},set:function(e,n){i(e,t,g(n))}}),s(v.prototype,{_active:g(!0),stopImmediatePropagation:g(x)}),i(c,t,{enumerable:!0,get:function(){return{value:r(null)}}}),s(n.prototype,{boundTo:g(b("boundTo")),emit:g(b("emit")),off:g(b("off")),on:g(b("on")),once:g(b("once")),trigger:g(b("trigger"))}),i(e,"eddy",{value:!0})})(typeof global=="undefined"?window:global)});