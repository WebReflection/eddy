/*! (C) Andrea Giammarchi Mit Style License */
define(function(){(function(e){"use strict";function m(e,t,n){E(this,e,t,n)}function g(){x.call(this),this._stopImmediatePropagation()}function y(e){return{configurable:!0,value:e}}function b(e){return function(){return s(this,a&&"dispatchEvent"in this?c:h)[e].apply(this,arguments)}}function w(e,t,n){t in e||(e[t]=n)}function E(e,t,n,r){w(e,"timeStamp",Date.now());for(var i in r)w(e,i,r[i]);w(e,"type",n),w(e,"target",t),r&&w(e,"data",r)}function S(e){return e._active=!0,e._stopImmediatePropagation=e.stopImmediatePropagation,e.stopImmediatePropagation=g,e}function x(){i(this,"_active",p)}function T(e,t,n){typeof e=="function"?e.apply(t,n):e.handleEvent.apply(e,n)}function N(e,t,n){typeof e=="function"?e.call(t,n):e.handleEvent(n)}function C(e){T(e,this.context,this.arguments)}function k(e){return C.call(this,e),this.arguments[0]._active}if(e.eddy)return;var t="_@eddy:"+Math.random(),n=e.Object,r=n.create,i=n.defineProperty,s=n.defineProperties,o=Array.prototype.slice,u=e.Node||e.Element||e.HTMLElement,a=!!u,f=y(function(n){var i=a?v.get(this)||(v.set(this,r(null)),v.get(this)):this[t],s=i[t]||(i[t]={m:[],b:[]}),o=typeof n=="string"?this[n]:n,u=s.m.indexOf(o);return u<0?s.b[s.m.push(o)-1]=o.bind(this):s.b[u]}),l=y(function(t,n,r){var i=this;return i.on(t,function s(){i.off(t,s,r),T(n,i,arguments)},r)}),c={boundTo:f,emit:y(function(t){return this.trigger(t,{data:o.call(arguments,1)})}),off:y(function(t,n,r){return this.removeEventListener(t,n,!!r),this}),on:y(function(t,n,r){return this.addEventListener(t,n,!!r),this}),once:l,trigger:y(function(n,r){var i=typeof n=="string",s=i?n:(r=n).type,o=(this.ownerDocument||this.document||e.document).createEvent("Event");return o.initEvent(s,r&&r.bubbles||1,r&&r.cancelable||1),E(o,this,s,i&&r),this.dispatchEvent(o),this})},h={boundTo:f,emit:y(function(n){var r=this[t][n],i=!!r;return i&&r.forEach(C,{arguments:(r.shift.call(arguments),arguments),context:this}),i}),off:y(function(n,r){var i=this[t],s=i[n],o;return s&&(o=s.indexOf(r),-1<o&&(s.splice(o,1),s.length||delete i[n])),this}),on:y(function(n,r){var i=this[t],s=i[n]||(i[n]=[]);return s.indexOf(r)<0&&s.push(r),this}),once:l,trigger:y(function(n,r){var i=this[t],s=typeof n=="string",o=i[s?n:n.type];return o&&o.every(k,{arguments:[s?new m(this,n,r):n instanceof m?n:S(n)],context:this}),this})},p={value:!1},d=e.WeakMap,v;a&&(v=d?new d:{get:function(e){return e[t]},set:function(e,n){i(e,t,y(n))}}),s(m.prototype,{_active:y(!0),stopImmediatePropagation:y(x)}),i(h,t,{enumerable:!0,get:function(){return{value:r(null)}}}),s(n.prototype,{boundTo:y(b("boundTo")),emit:y(b("emit")),off:y(b("off")),on:y(b("on")),once:y(b("once")),trigger:y(b("trigger"))}),i(e,"eddy",{value:!0})})(typeof global=="undefined"?window:global)});